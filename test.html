<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Content Script Test Page</title>
    <script>
      // Simple mock for chrome APIs for development with Vite dev server
      if (typeof globalThis.chrome?.storage === 'undefined') {
        console.log('[DEV] Mocking chrome.storage API for live reload server.')

        const mockMacros = [
          { id: '1', command: '/sig', text: 'My Signature', contentType: 'text/plain' },
          { id: '2', command: '/brb', text: 'Be right back', contentType: 'text/plain' },
          {
            id: '3',
            command: '/nova',
            contentType: 'text/html',
            html: '<p><b>A list</b></p><ul><li>one</li><li>two</li></ul><p>And a number:</p><ol><li>first</li></ol>',
            // This is the correctly formatted plain text that your content script should use.
            text: 'A list\n\n• one\n• two\n\nAnd a number:\n\n1. first'
          }
        ];

        // --- DEV CONFIG ---
        // You can change this to test different settings.
        const mockConfig = {
          useCommitKeys: false,
          prefixes: ['/'],
          // Add 'localhost' to this array to test the disabled state.
          disabledSites: [],
        }
        // ------------------

        globalThis.chrome = globalThis.chrome || {}
        globalThis.chrome.storage = {
          local: {
            get: (keys, callback) => {
              const result = { macros: mockMacros, config: mockConfig }
              console.log('[DEV] chrome.storage.local.get', keys, '->', result)
              if (callback) {
                callback(result)
              }
              return Promise.resolve(result)
            },
            set: (items, callback) => {
              console.log('[DEV] chrome.storage.local.set', items)
              if (callback) {
                callback()
              }
              return Promise.resolve()
            },
          },
          onChanged: {
            addListener: () => {},
          },
        }
      }
    </script>
  </head>
  <body>
    <h1>Content Script Test Page</h1>
    <p>This page is for testing the macro detection content script with live reload.</p>
    <div contenteditable="true" style="border: 1px solid #ccc; min-height: 100px; padding: 5px; margin-top: 1em">
      Start typing here...
    </div>
    <hr />
    <textarea style="width: 100%; height: 100px; border: 1px solid #ccc; padding: 5px" placeholder="Or type in this textarea..."></textarea>

    <!-- This script will be handled by Vite's dev server for HMR/live reload -->
    <script type="module" src="/src/content/main.ts"></script>
  </body>
</html>